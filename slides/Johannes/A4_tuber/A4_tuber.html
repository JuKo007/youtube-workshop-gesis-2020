<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Automatic sampling and analysis of YouTubeData</title>
    <meta charset="utf-8" />
    <meta name="author" content="Julian Kohne Johannes Breuer M. Rohangis Mohseni" />
    <meta name="date" content="2020-02-10" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="..\workshop.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Automatic sampling and analysis of YouTubeData
## Collecting data with the tuber package for R
### Julian Kohne<br />Johannes Breuer<br />M. Rohangis Mohseni
### 2020-02-10

---

layout: true



&lt;div class="my-footer"&gt;
  &lt;div style="float: left;"&gt;&lt;span&gt;Julian Kohne, Johannes Breuer, M. Rohangis Mohseni&lt;/span&gt;&lt;/div&gt;
  &lt;div style="float: right;"&gt;&lt;span&gt;GESIS, Cologne, Germany, 2020-02-10&lt;/span&gt;&lt;/div&gt;
  &lt;div style="text-align: center;"&gt;&lt;span&gt;Collecting data with the tuber package for R&lt;/span&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;style type="text/css"&gt;

pre {
  font-size: 10px
}
&lt;/style&gt;

---

# The `tuber` package

With the [`tuber` package](https://github.com/soodoku/tuber) you can access the *YouTube* API via `R`. The author of the package has written a short [vignette](https://cran.r-project.org/web/packages/tuber/vignettes/tuber-ex.html) to introduce some of its main functions.

Essentially, there are three main units of analysis for which you can access data with the `tuber` package:

- Videos
- Channels
- Playlists

In this workshop, we will focus on individual **videos**.

---

# Setup


```r
install.packages("tuber")
install.packages("tidyverse")
library(tuber)
library(tidyverse)
options(stringsAsFactors = FALSE)
```

---

# Excursus: Keep your secrets secret

If you save your API credentials in an R script, anyone who has that script can potentially use your API key. This can affect your quota and might even cause costs for you.

If you use R environment variables, your credentials won't be shared if you share your scripts. However, the information is still stored in a plain text file. You can run `usethis::edit_r_environ()` to see its contents.

One way of keeping your credentials safer is using the `keyring` package.


```r
install.packages("keyring")
library(keyring)
```

---

# Excursus: The `keyring` package

To store your credentials in an encrypted password-protected keyring you first need to create a new keyring.


```r
keyring_create("YouTube_API")
```

You will then be prompted to set a password for this keyring. As always: This password should ideally be easy to remember (for you) but hard to guess (for anyone else). You might want to write it down or store it in your password manager (if you use one). In the next step, you can store your *YouTube* app secret in the keyring.

```r
key_set("app_secret", 
        keyring ="YouTube_API")
```

When you are prompted to enter the password now you should enter your app secret. At the end of your script, you should lock the keyring again.

```r
keyring_lock("YouTube_API")
```

---

# Authenticate your app


```r
yt_oauth(app_id = "my_app_id", # paste your app ID here
         app_secret = "my_app_secret", # paste your app secret here
         token="")
```
or, if you stored your app secret in a keyring


```r
yt_oauth(app_id = "my_app_id",  # paste your app ID here
         app_secret = key_get("app_secret", keyring ="YouTube_API"),
         token="")
```

---

# Authentication

When running the `yt_oauth()` function there will be a prompt in the console asking you to save the access token in a file. If you select "Yes", `tuber` will create a local file (in your working directory) to cache [OAuth](https://en.wikipedia.org/wiki/OAuth) access credentials between `R` sessions. The token stored in this file will be valid for one hour (and can be automatically refreshed). Doing this makes sense if you know you will be running multiple R sessions that need your credentials (example: knitting an `RMarkdown` document). 

Similar to the app key and secret, you should never share the `.httr-oauth` file as it can be read in `R` using `read_RDS()` (the file contains a list list with all information needed for OAuth, including your app key and secret). Hence, it is usually ok (and safer) to select "No" when asked whether to store a local `.httr-oauth` file. 
---

# App permissions

After making your choice regarding the `.httr-oauth` file, a browser window should open, prompting you to log in with your Google account and to give permissions. Google will probably tell you that it is not safe to grant the app access to your account. However, since you created the app and presumably are its sole user, you can go ahead and trust yourself: Click "Extended", and then "Accept". After that, you can close the browser and return to `R`.

---

# `tuber` test


```r
yt_oauth()
get_video_details ("DcJFdCmN98s")
```

```
## $kind
## [1] "youtube#videoListResponse"
## 
## $etag
## [1] "\"p4VTdlkQv3HQeTEaXgvLePAydmU/f6jz00JzFOgn3Q5jpZ99aHDVsrc\""
## 
## $pageInfo
## $pageInfo$totalResults
## [1] 1
## 
## $pageInfo$resultsPerPage
## [1] 1
## 
## 
## $items
## $items[[1]]
## $items[[1]]$kind
## [1] "youtube#video"
## 
## $items[[1]]$etag
## [1] "\"p4VTdlkQv3HQeTEaXgvLePAydmU/QlzWceWcQMKlb1mVxhoUj11hSgw\""
## 
## $items[[1]]$id
## [1] "DcJFdCmN98s"
## 
## $items[[1]]$snippet
## $items[[1]]$snippet$publishedAt
## [1] "2012-08-15T22:04:48.000Z"
## 
## $items[[1]]$snippet$channelId
## [1] "UCNYrK4tc5i1-eL8TXesH2pg"
## 
## $items[[1]]$snippet$title
## [1] "OH MY DAYUM ft. Daym Drops"
## 
## $items[[1]]$snippet$description
## [1] "the track on itunes- https://itunes.apple.com/us/album/oh-my-dayum-single/id553920419 (it's also streaming everywhere, even spotify &amp; your grandmom's house)\nDaym's Channel: http://youtube.com/GhettoNN\nOriginal Video:\nhttp://www.youtube.com/watch?v=zGkHRa64sDY\nour new Christmas album: https://thegregorybrothers.bandcamp.com/\nGet exclusive videos from us for just $1! https://www.patreon.com/gregorybrothers\n\n\n\nfeaturing the vocals of Catherine Provenzano\nhttps://kenniston.bandcamp.com/releases\nmastering by Dan Millice: http://www.danmillice.com/\n\nour stuff that you should click, to be happier:\nYouTube 2! http://www.youtube.com/thegregorybrothers\nFacebook! http://www.facebook.com/gregorybrothers\nTwitter! http://www.twitter.com/gregorybrothers\nWebs &amp; Store! http://www.thegregorybrothers.com\n\nChords:\n(intro) Cm Ab Cm Ab\n(chorus) Db Ab C7 Fm-Cm-Db-Ab\n(verse) Cm Ab Gm Fm\n\nLyrics:\n\noh my goodness, oh my damn\noh my goodness- they goin H.A.M.\n\nthis is how bacon is supposed to be\nthe fries, they blend so perfectly\nthe cheese up in here is goin H.A.M.\ndayum, dayum, DAYUM\n\ni wish you could smell what i'm smellin\nmm, mm, mm\nyou bite the fry, the fry bites back, my man\ndayum, dayum\n\nDAYUM, crispety crunch\nDAYUM, look at the bacon\nDAYUM, get yourself that double cheeseburger\ndayum, dayum\n\nDAYUM, ghetto grocery bag\nDAYUM, the cheese is oozin\nDAYUM, let's do this\ndayum, dayum, DAYUM\n\ndo you wanna know the difference\nbetween a weak burger\nand a burger that has strength\na burger that has strength\n\na weak burger you can chew and still talk\na burger with strength you chew\nthe meat just absorbs all the space\nand all the air possible all in your throat\nto the point that if you wanted to start talkin\nnothin but mm-mm, mm-mm, mm-mm, mm-mm, mm-mm\nis comin out\nword\n\nskimmalarinky dinky dink\nskimmmalarinky doo\ni love you\noh my damn\n\nchorus\n\n#Dayum #Songify #SongifyThis"
## 
## $items[[1]]$snippet$thumbnails
## $items[[1]]$snippet$thumbnails$default
## $items[[1]]$snippet$thumbnails$default$url
## [1] "https://i.ytimg.com/vi/DcJFdCmN98s/default.jpg"
## 
## $items[[1]]$snippet$thumbnails$default$width
## [1] 120
## 
## $items[[1]]$snippet$thumbnails$default$height
## [1] 90
## 
## 
## $items[[1]]$snippet$thumbnails$medium
## $items[[1]]$snippet$thumbnails$medium$url
## [1] "https://i.ytimg.com/vi/DcJFdCmN98s/mqdefault.jpg"
## 
## $items[[1]]$snippet$thumbnails$medium$width
## [1] 320
## 
## $items[[1]]$snippet$thumbnails$medium$height
## [1] 180
## 
## 
## $items[[1]]$snippet$thumbnails$high
## $items[[1]]$snippet$thumbnails$high$url
## [1] "https://i.ytimg.com/vi/DcJFdCmN98s/hqdefault.jpg"
## 
## $items[[1]]$snippet$thumbnails$high$width
## [1] 480
## 
## $items[[1]]$snippet$thumbnails$high$height
## [1] 360
## 
## 
## $items[[1]]$snippet$thumbnails$standard
## $items[[1]]$snippet$thumbnails$standard$url
## [1] "https://i.ytimg.com/vi/DcJFdCmN98s/sddefault.jpg"
## 
## $items[[1]]$snippet$thumbnails$standard$width
## [1] 640
## 
## $items[[1]]$snippet$thumbnails$standard$height
## [1] 480
## 
## 
## $items[[1]]$snippet$thumbnails$maxres
## $items[[1]]$snippet$thumbnails$maxres$url
## [1] "https://i.ytimg.com/vi/DcJFdCmN98s/maxresdefault.jpg"
## 
## $items[[1]]$snippet$thumbnails$maxres$width
## [1] 1280
## 
## $items[[1]]$snippet$thumbnails$maxres$height
## [1] 720
## 
## 
## 
## $items[[1]]$snippet$channelTitle
## [1] "schmoyoho"
## 
## $items[[1]]$snippet$tags
## $items[[1]]$snippet$tags[[1]]
## [1] "guys"
## 
## $items[[1]]$snippet$tags[[2]]
## [1] "five"
## 
## $items[[1]]$snippet$tags[[3]]
## [1] "burgers"
## 
## $items[[1]]$snippet$tags[[4]]
## [1] "and"
## 
## $items[[1]]$snippet$tags[[5]]
## [1] "fries"
## 
## $items[[1]]$snippet$tags[[6]]
## [1] "burger"
## 
## $items[[1]]$snippet$tags[[7]]
## [1] "cheese"
## 
## $items[[1]]$snippet$tags[[8]]
## [1] "cheeseburger"
## 
## $items[[1]]$snippet$tags[[9]]
## [1] "daym"
## 
## $items[[1]]$snippet$tags[[10]]
## [1] "drops"
## 
## $items[[1]]$snippet$tags[[11]]
## [1] "GNN"
## 
## $items[[1]]$snippet$tags[[12]]
## [1] "ghetto"
## 
## $items[[1]]$snippet$tags[[13]]
## [1] "news"
## 
## $items[[1]]$snippet$tags[[14]]
## [1] "network"
## 
## $items[[1]]$snippet$tags[[15]]
## [1] "review"
## 
## $items[[1]]$snippet$tags[[16]]
## [1] "auto"
## 
## $items[[1]]$snippet$tags[[17]]
## [1] "tune"
## 
## $items[[1]]$snippet$tags[[18]]
## [1] "the"
## 
## $items[[1]]$snippet$tags[[19]]
## [1] "songify"
## 
## $items[[1]]$snippet$tags[[20]]
## [1] "this"
## 
## $items[[1]]$snippet$tags[[21]]
## [1] "gregory"
## 
## $items[[1]]$snippet$tags[[22]]
## [1] "brothers"
## 
## $items[[1]]$snippet$tags[[23]]
## [1] "andrew"
## 
## $items[[1]]$snippet$tags[[24]]
## [1] "evan"
## 
## $items[[1]]$snippet$tags[[25]]
## [1] "michael"
## 
## $items[[1]]$snippet$tags[[26]]
## [1] "sarah"
## 
## $items[[1]]$snippet$tags[[27]]
## [1] "oh"
## 
## $items[[1]]$snippet$tags[[28]]
## [1] "my"
## 
## $items[[1]]$snippet$tags[[29]]
## [1] "dayum"
## 
## $items[[1]]$snippet$tags[[30]]
## [1] "oh my dayum"
## 
## $items[[1]]$snippet$tags[[31]]
## [1] "shmoyoho"
## 
## $items[[1]]$snippet$tags[[32]]
## [1] "shmoyo"
## 
## $items[[1]]$snippet$tags[[33]]
## [1] "schmoyoho"
## 
## $items[[1]]$snippet$tags[[34]]
## [1] "daymon"
## 
## $items[[1]]$snippet$tags[[35]]
## [1] "patterson"
## 
## $items[[1]]$snippet$tags[[36]]
## [1] "5 guys"
## 
## $items[[1]]$snippet$tags[[37]]
## [1] "dayum dayum dayum"
## 
## $items[[1]]$snippet$tags[[38]]
## [1] "comedy"
## 
## $items[[1]]$snippet$tags[[39]]
## [1] "song"
## 
## $items[[1]]$snippet$tags[[40]]
## [1] "parody"
## 
## $items[[1]]$snippet$tags[[41]]
## [1] "spoof"
## 
## $items[[1]]$snippet$tags[[42]]
## [1] "food review"
## 
## 
## $items[[1]]$snippet$categoryId
## [1] "25"
## 
## $items[[1]]$snippet$liveBroadcastContent
## [1] "none"
## 
## $items[[1]]$snippet$defaultLanguage
## [1] "en"
## 
## $items[[1]]$snippet$localized
## $items[[1]]$snippet$localized$title
## [1] "OH MY DAYUM ft. Daym Drops"
## 
## $items[[1]]$snippet$localized$description
## [1] "the track on itunes- https://itunes.apple.com/us/album/oh-my-dayum-single/id553920419 (it's also streaming everywhere, even spotify &amp; your grandmom's house)\nDaym's Channel: http://youtube.com/GhettoNN\nOriginal Video:\nhttp://www.youtube.com/watch?v=zGkHRa64sDY\nour new Christmas album: https://thegregorybrothers.bandcamp.com/\nGet exclusive videos from us for just $1! https://www.patreon.com/gregorybrothers\n\n\n\nfeaturing the vocals of Catherine Provenzano\nhttps://kenniston.bandcamp.com/releases\nmastering by Dan Millice: http://www.danmillice.com/\n\nour stuff that you should click, to be happier:\nYouTube 2! http://www.youtube.com/thegregorybrothers\nFacebook! http://www.facebook.com/gregorybrothers\nTwitter! http://www.twitter.com/gregorybrothers\nWebs &amp; Store! http://www.thegregorybrothers.com\n\nChords:\n(intro) Cm Ab Cm Ab\n(chorus) Db Ab C7 Fm-Cm-Db-Ab\n(verse) Cm Ab Gm Fm\n\nLyrics:\n\noh my goodness, oh my damn\noh my goodness- they goin H.A.M.\n\nthis is how bacon is supposed to be\nthe fries, they blend so perfectly\nthe cheese up in here is goin H.A.M.\ndayum, dayum, DAYUM\n\ni wish you could smell what i'm smellin\nmm, mm, mm\nyou bite the fry, the fry bites back, my man\ndayum, dayum\n\nDAYUM, crispety crunch\nDAYUM, look at the bacon\nDAYUM, get yourself that double cheeseburger\ndayum, dayum\n\nDAYUM, ghetto grocery bag\nDAYUM, the cheese is oozin\nDAYUM, let's do this\ndayum, dayum, DAYUM\n\ndo you wanna know the difference\nbetween a weak burger\nand a burger that has strength\na burger that has strength\n\na weak burger you can chew and still talk\na burger with strength you chew\nthe meat just absorbs all the space\nand all the air possible all in your throat\nto the point that if you wanted to start talkin\nnothin but mm-mm, mm-mm, mm-mm, mm-mm, mm-mm\nis comin out\nword\n\nskimmalarinky dinky dink\nskimmmalarinky doo\ni love you\noh my damn\n\nchorus\n\n#Dayum #Songify #SongifyThis"
## 
## 
## $items[[1]]$snippet$defaultAudioLanguage
## [1] "en"
```

---

# Channel statistics


```r
hadley_stats &lt;- get_channel_stats("UCxOhDvtaoXDAB336AolWs3A")
```

```
## Channel Title: Hadley Wickham 
## No. of Views: 41702 
## No. of Subscribers: 2630 
## No. of Videos: 4
```

---

# Channel statistics
`get_channel_stats` returns a list which can then be wrangled into a dataframe (tibble).


```r
hadley_stats_df &lt;- hadley_stats$statistics %&gt;% 
  as_tibble() %&gt;% 
  mutate_at(vars(-hiddenSubscriberCount), as.numeric) %&gt;% 
  mutate(channel_id = hadley_stats$id,
         channel_name = hadley_stats$snippet$title,
         channel_published = hadley_stats$snippet$publishedAt)

hadley_stats_df
```

```
## # A tibble: 1 x 8
##   viewCount commentCount subscriberCount hiddenSubscribe~ videoCount
##       &lt;dbl&gt;        &lt;dbl&gt;           &lt;dbl&gt; &lt;lgl&gt;                 &lt;dbl&gt;
## 1     41702            0            2630 FALSE                     4
## # ... with 3 more variables: channel_id &lt;chr&gt;, channel_name &lt;chr&gt;,
## #   channel_published &lt;chr&gt;
```


---

# Other useful `tuber` functions

`get_video_details("video_id")`: list with metadata for the video (e.g., title, description, tags) 

---

class: center, middle

# [Exercise](https://jobreu.github.io/tidyverse-workshop-gesis-2019/exercises/A5_DataWrangling1_exercises_question.html) time 🏋️‍♀️💪🏃🚴

## [Solutions](https://jobreu.github.io/tidyverse-workshop-gesis-2019/solutions/A5_DataWrangling1_exercises_solution.html)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
